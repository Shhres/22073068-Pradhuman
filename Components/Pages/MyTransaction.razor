@page "/mytransaction"
@using MauiApp1.Models
@inject UserService UserService

<div class="container mx-auto p-8 bg-gradient-to-r from-blue-100 via-purple-200 to-pink-200 rounded-3xl shadow-lg">
    <h1 class="text-5xl font-extrabold text-center mb-10 text-purple-800 tracking-wide drop-shadow-md">User Transactions</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="group">
            <label for="searchTitle" class="block text-sm font-medium text-gray-700 mb-2">Search by Title</label>
            <input id="searchTitle" type="text" @bind-value="searchTitle"
                   class="w-full px-5 py-3 border-2 rounded-lg shadow-lg focus:ring-2 focus:ring-purple-500 focus:outline-none transition-all ease-in-out duration-300"
                   placeholder="Enter transaction title" />
        </div>

        <div class="group">
            <label for="searchDate" class="block text-sm font-medium text-gray-700 mb-2">Search by Date</label>
            <input id="searchDate" type="date" @bind-value="searchDate"
                   class="w-full px-5 py-3 border-2 rounded-lg shadow-lg focus:ring-2 focus:ring-purple-500 focus:outline-none transition-all ease-in-out duration-300" />
        </div>

        <div class="group">
            <label for="searchId" class="block text-sm font-medium text-gray-700 mb-2">Search by Transaction ID</label>
            <input id="searchId" type="number" @bind-value="searchId"
                   class="w-full px-5 py-3 border-2 rounded-lg shadow-lg focus:ring-2 focus:ring-purple-500 focus:outline-none transition-all ease-in-out duration-300"
                   placeholder="Enter transaction ID" />
        </div>

        <div class="group">
            <label for="searchLabel" class="block text-sm font-medium text-gray-700 mb-2">Search by Label</label>
            <input id="searchLabel" type="text" @bind-value="searchLabel"
                   class="w-full px-5 py-3 border-2 rounded-lg shadow-lg focus:ring-2 focus:ring-purple-500 focus:outline-none transition-all ease-in-out duration-300"
                   placeholder="Enter label" />
        </div>
    </div>

    <button @onclick="HandleSearch"
            class="w-full px-6 py-3 text-lg text-white bg-purple-600 font-semibold rounded-lg shadow-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all ease-in-out duration-300 transform hover:scale-105">
        Search
    </button>

    @if (noDataFound)
    {
        <div class="mt-6 text-center text-red-500 font-semibold">
            <p>No data found for your search criteria.</p>
        </div>
    }

    <div class="mt-12 overflow-x-auto shadow-lg rounded-lg bg-white">
        <table class="w-full text-sm text-left text-gray-700">
            <thead class="bg-gradient-to-r from-purple-600 to-blue-600 text-white">
                <tr>
                    <th class="px-6 py-3">Transaction ID</th>
                    <th class="px-6 py-3">Title</th>
                    <th class="px-6 py-3">Label</th>
                    <th class="px-6 py-3">Total Amount</th>
                    <th class="px-6 py-3">Debit</th>
                    <th class="px-6 py-3">Credit</th>
                    <th class="px-6 py-3">Date</th>
                    <th class="px-6 py-3">Description</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-100">
                @foreach (var transaction in filteredTransactions)
                {
                    <tr class="transition-all duration-300 ease-in-out hover:bg-gray-50 transform hover:scale-105">
                        <td class="px-6 py-4 text-gray-700">@transaction.Id</td>
                        <td class="px-6 py-4 text-gray-700 font-semibold">@transaction.Title</td>
                        <td class="px-6 py-4 text-gray-700">@transaction.Description</td>
                        <td class="px-6 py-4 text-gray-800 font-bold">@((Data.Transactions.Sum(t => t.Credit) - Data.Transactions.Sum(t => t.Debit)).ToString("C"))</td>
                        <td class="px-6 py-4 text-red-500">@transaction.Debit.ToString("C")</td>
                        <td class="px-6 py-4 text-green-500">@transaction.Credit.ToString("C")</td>
                        <td class="px-6 py-4 text-gray-700">@transaction.Date.ToString("MM/dd/yyyy")</td>
                        <td class="px-6 py-4 text-gray-700">@transaction.Description</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@code {
    private AppData Data;
    private string searchTitle = string.Empty;
    private DateTime? searchDate = null;
    private int? searchId = null;
    private string searchLabel = string.Empty;
    private List<Transaction> filteredTransactions = new List<Transaction>();
    private bool noDataFound = false;

    protected override void OnInitialized()
    {
        Data = UserService.LoadData();
        filteredTransactions = Data.Transactions;
    }

    private void HandleSearch()
    {
        filteredTransactions = Data.Transactions.Where(t =>
            (string.IsNullOrEmpty(searchTitle) || t.Title.Equals(searchTitle, StringComparison.OrdinalIgnoreCase)) &&  // Exact match for Title
            (!searchDate.HasValue || t.Date.Date == searchDate.Value.Date) &&
            (!searchId.HasValue || t.Id == searchId.Value) &&
            (string.IsNullOrEmpty(searchLabel) || t.Description.Equals(searchLabel, StringComparison.OrdinalIgnoreCase))  // Exact match for Label
        ).ToList();

        // Check if no data is found after filtering
        noDataFound = filteredTransactions.Count == 0;
    }
}
