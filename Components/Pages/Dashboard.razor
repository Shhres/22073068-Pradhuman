@page "/dashboard"
@using MauiApp1.Models
@inject NavigationManager Navigation
@using MauiApp1.Components.Layout
@inject UserService UserService

<div class="container-fluid p-0">
    <!-- Header Section -->
    <div class="text-center py-3 bg-primary">
        <h1 class="mb-0" style="color: black; font-weight: bold;">Dashboard</h1>
        <p class="mt-1" style="color: black; font-weight: bold;">A summary of your financial details</p>
    </div>

    <!-- Total Amount Section -->
    <div class="py-5 bg-white">
        <div class="row mx-3">
            <!-- Total Amount -->
            <div class="col-md-12 text-center mb-4">
                <h5>Total Amount</h5>
                <div class="d-flex justify-content-center align-items-center">
                    <span class="h4">
                        @if (isAmountVisible)
                        {
                            <span>@($"${TotalAmount:F2}")</span>
                        }
                        else
                        {
                            <span>••••••</span>
                        }
                    </span>
                    <button class="btn btn-link" @onclick="ToggleAmountVisibility">
                        @if (isAmountVisible)
                        {
                            <i class="bi bi-eye-slash text-dark"></i>
                        }
                        else
                        {
                            <i class="bi bi-eye text-dark"></i>
                        }
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Background Section -->
    <div class="vh-50" style="background-image: url('css/dotnet.jpg'); background-size: cover; background-position: center; height: 50vh;">
        <!-- Empty content; image serves as decoration -->
    </div>
</div>

@code {
    private bool isAmountVisible = false;
    private decimal TotalAmount = 0m;

    private AppData Data;
    private List<User> Users = new List<User>();

    private List<Transaction> Transactions => Data?.Transactions ?? new List<Transaction>();

    protected override void OnInitialized()
    {
        // Load users from UserService when the component is initialized
        Users = UserService.LoadUsers();

        // Calculate Total Amount
        var totalCredit = Transactions.Sum(t => t.Credit);
        var totalDebit = Transactions.Sum(t => t.Debit);
        TotalAmount = totalCredit - totalDebit;
    }

    private void ToggleAmountVisibility()
    {
        isAmountVisible = !isAmountVisible;
    }
}
